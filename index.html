<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雙人卡牌對戰遊戲</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <div class="background-animation"></div>

    <div class="main-container">
        <h1 class="game-title">
            <span class="glow">卡牌</span>
            <span class="glow delay-1">對戰</span>
            <span class="glow delay-2">競技場</span>
        </h1>

        <div class="subtitle">雙人戰鬥 | 策略對決</div>

        <div class="button-container">
            <button class="main-button" id="startGameBtn">
                <span class="button-glow"></span>
                <span class="button-text">進入遊戲</span>
            </button>

            <button class="main-button secondary" id="settingsBtn">
                <span class="button-glow"></span>
                <span class="button-text">設定</span>
            </button>

            <button class="main-button" id="changelogBtn"
                style="border-color: var(--neon-accent); color: var(--neon-accent);">
                <span class="button-glow"
                    style="background: radial-gradient(circle, rgba(255, 255, 0, 0.4), transparent);"></span>
                <span class="button-text">更新日誌</span>
            </button>

            <button class="main-button secondary" id="charListBtn" style="border-color: #00ff88; color: #00ff88;">
                <span class="button-glow"
                    style="background: radial-gradient(circle, rgba(0, 255, 136, 0.4), transparent);"></span>
                <span class="button-text">角色列表</span>
            </button>
        </div>

        <div class="info-section">
            <div class="info-card">
                <div class="card-icon">🎴</div>
                <h3>100+張卡牌</h3>
                <p>包含神話、傳說、史詩等多種稀有度</p>
            </div>

            <div class="info-card">
                <div class="card-icon">⚔️</div>
                <h3>策略對戰</h3>
                <p>運用技能與冷卻機制制勝</p>
            </div>

            <div class="info-card">
                <div class="card-icon">🎲</div>
                <h3>隨機抽卡</h3>
                <p>基於稀有度的抽卡系統</p>
            </div>
        </div>
    </div>

    <!-- 設定面板 -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-content">
            <h2>遊戲設定</h2>
            <button class="close-btn" id="closeSettings">✕</button>

            <div class="setting-item">
                <label for="musicVolume">音樂音量</label>
                <input type="range" id="musicVolume" min="0" max="100" value="50">
                <span class="volume-display">50%</span>
            </div>

            <div class="setting-item">
                <label for="sfxVolume">音效音量</label>
                <input type="range" id="sfxVolume" min="0" max="100" value="70">
                <span class="volume-display">70%</span>
            </div>

            <div class="setting-item">
                <label>動畫效果</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="animations" checked>
                    <span class="slider"></span>
                </div>
            </div>

            <div class="setting-item">
                <label>稀有度顯示</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="showRarity" checked>
                    <span class="slider"></span>
                </div>
            </div>

            <div class="rules-section">
                <h3>遊戲規則</h3>
                <ul>
                    <li>雙方各抽取5張卡牌作為初始手牌</li>
                    <li>投擲硬幣決定先手順序</li>
                    <li>選擇1張卡牌放入戰鬥區開始對戰</li>
                    <li>每回合可以使用1個技能或普攻</li>
                    <li>撤退可以切換戰鬥區卡牌，但會消耗該回合</li>
                    <li>當一方沒有任何卡牌時即判定輸掉遊戲</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 更新日誌面板 -->
    <div class="settings-panel" id="changelogPanel">
        <div class="settings-content">
            <h2>更新日誌</h2>
            <button class="close-btn" id="closeChangelog">✕</button>
            <div class="changelog-body" style="line-height:2.5; font-size:1.1rem; color:#ccc;">
                <p
                    style="color:var(--neon-accent); font-weight:bold; font-size:1.4rem; border-bottom:1px solid rgba(255,255,0,0.2); margin-bottom:10px;">
                    版本: beta 2.1</p>
                <p><span style="color:#00ff88;">🟢 本版增強:</span> (請在此填入內容)</p>
                <p><span style="color:#ff3333;">🔴 本版削弱:</span> (請在此填入內容)</p>
                <p><span style="color:#66ccff;">🔵 平衡性調整:</span> (請在此填入內容)</p>
            </div>
        </div>
    </div>

    <!-- 角色列表面板 -->
    <div class="settings-panel" id="charListPanel">
        <div class="settings-content" style="max-width: 1200px; width: 95%;">
            <h2>角色圖鑑</h2>
            <button class="close-btn" id="closeCharList">✕</button>
            <div id="charListContainer"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- 由 JS 動態生成 -->
            </div>
        </div>
    </div>

    <script src="scripts/data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Homepage logic initialized");

            // Helper to toggle panels
            const togglePanel = (id, active) => {
                const el = document.getElementById(id);
                if (el) {
                    if (active) el.classList.add('active');
                    else el.classList.remove('active');
                } else {
                    console.error("Panel not found:", id);
                }
            };

            // Event Listeners
            const safeAddListener = (id, type, callback) => {
                const el = document.getElementById(id);
                if (el) el.addEventListener(type, callback);
                else console.warn("Element not found for listener:", id);
            };

            safeAddListener('startGameBtn', 'click', () => {
                window.location.href = 'game.html';
            });

            safeAddListener('settingsBtn', 'click', () => togglePanel('settingsPanel', true));
            safeAddListener('closeSettings', 'click', () => togglePanel('settingsPanel', false));

            safeAddListener('changelogBtn', 'click', () => togglePanel('changelogPanel', true));
            safeAddListener('closeChangelog', 'click', () => togglePanel('changelogPanel', false));

            safeAddListener('charListBtn', 'click', () => {
                renderCharacterList();
                togglePanel('charListPanel', true);
            });
            safeAddListener('closeCharList', 'click', () => togglePanel('charListPanel', false));

            // Volume Logic
            const musicInput = document.getElementById('musicVolume');
            const sfxInput = document.getElementById('sfxVolume');

            if (musicInput) {
                musicInput.addEventListener('input', (e) => {
                    const val = e.target.value;
                    const display = e.target.nextElementSibling;
                    if (display) display.textContent = val + '%';
                    localStorage.setItem('musicVolume', val);
                });
            }

            if (sfxInput) {
                sfxInput.addEventListener('input', (e) => {
                    const val = e.target.value;
                    const display = e.target.nextElementSibling;
                    if (display) display.textContent = val + '%';
                    localStorage.setItem('sfxVolume', val);
                });
            }

            // Load saved settings
            const musicVolume = localStorage.getItem('musicVolume') || 50;
            const sfxVolume = localStorage.getItem('sfxVolume') || 70;

            if (musicInput) {
                musicInput.value = musicVolume;
                const display = musicInput.nextElementSibling;
                if (display) display.textContent = musicVolume + '%';
            }
            if (sfxInput) {
                sfxInput.value = sfxVolume;
                const display = sfxInput.nextElementSibling;
                if (display) display.textContent = sfxVolume + '%';
            }

            // 渲染角色列表
            function renderCharacterList() {
                const container = document.getElementById('charListContainer');
                if (!container || container.children.length > 0) return;

                if (typeof CHARACTERS === 'undefined') {
                    console.error("CHARACTERS data not loaded!");
                    return;
                }

                CHARACTERS.forEach(char => {
                    const card = document.createElement('div');
                    card.style.cssText = `
                        background: rgba(255,255,255,0.05);
                        border: 1px solid rgba(255,255,255,0.1);
                        border-radius: 10px;
                        padding: 15px;
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    `;

                    const rarityColors = {
                        '一般': '#808080',
                        '稀有': '#00b0f0',
                        '史詩': '#9900ff',
                        '傳裝': '#ffc000',
                        '傳說': '#ffc000',
                        '神話': '#ff0000'
                    };
                    const rColor = rarityColors[char.rarity] || '#fff';

                    card.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:bold; font-size:1.2rem; color:#fff;">${char.name}</span>
                            <span style="background:${rColor}; color:#fff; padding:2px 8px; border-radius:4px; font-size:0.8rem;">${char.rarity}</span>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; font-size:0.9rem; color:#aaa;">
                            <span>HP: ${char.hp}</span>
                            <span>ATK: ${char.atk}</span>
                        </div>
                        <div style="border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                            <div style="color:var(--neon-primary); font-size:0.85rem; font-weight:bold; margin-bottom:5px;">技能:</div>
                            ${char.skills.map(s => `
                                <div style="font-size:0.8rem; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:4px; margin-bottom:4px;">
                                    <span style="color:#fff;">${s.name}</span> <span style="color:#aaa;">(CD:${s.cooldown || 0})</span>
                                </div>
                            `).join('')}
                        </div>
                        ${char.passive ? `
                            <div style="border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                                <div style="color:var(--neon-secondary); font-size:0.85rem; font-weight:bold; margin-bottom:5px;">被動:</div>
                                <div style="font-size:0.8rem; color:#ccc;">${char.passive.name}</div>
                            </div>
                        ` : ''}
                    `;
                    container.appendChild(card);
                });
            }
        });
    </script>
</body>

</html>